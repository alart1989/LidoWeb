const PRODUCTION=!/(^|\.)localhost(:\d+)?$/.test(location.host)&&!/127\.0\.0\.1/.test(location.host),MAIN_BASE=PRODUCTION?"https://yourdomain.tld":"http://localhost:8000",STAKE_BASE=PRODUCTION?"https://stake.yourdomain.tld":"http://localhost:8001",ORIGIN_MAIN="https://lido.fi",ORIGIN_STAKE="https://stake.lido.fi",MAIN_ORIGINS=new Set(["https://lido.fi","https://www.lido.fi","http://lido.fi","http://www.lido.fi"]),isStake=location.origin.startsWith(STAKE_BASE)||location.hostname.startsWith("stake.")||"8001"===location.port;function folderize(t){return t&&"#"!==t?"/"===t||t.endsWith("/")?t:t+"/":"/"}function isMainOriginUrl(t){try{const e=t.startsWith("http")?new URL(t):new URL(t,location.origin);return MAIN_ORIGINS.has(e.origin)}catch{return!1}}function redirectToLocalMain(){location.href=isStake?MAIN_BASE+"/":"/"}function rewriteStakeLinks(){if(!isStake)return;const t=t=>"/withdrawals/"===(t=folderize(t))?"/withdrawals/request/":t;document.querySelectorAll("a[href]").forEach(e=>{const i=e.getAttribute("href")||"";try{if(i.startsWith("/"))return void e.setAttribute("href",t(i));if(i.startsWith(ORIGIN_STAKE)||i.startsWith(STAKE_BASE)){const o=new URL(i).pathname;e.setAttribute("href",t(o))}}catch{}})}function guardMainLinksStrict(){if(isStake)return;const t=t=>{const e=(t.composedPath?t.composedPath():[t.target]).find(t=>t&&"A"===t.tagName&&void 0!==t.href);if(e){if(e.hasAttribute("data-active-stake"))return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),void(location.href=STAKE_BASE+"/");t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()}};["click","pointerdown","mousedown","mouseup","auxclick","touchstart","touchend"].forEach(e=>document.addEventListener(e,t,!0)),window.open,window.open=function(t,e,i){return String(t).includes("stake.lido.fi")?(location.href=STAKE_BASE+"/",null):null}}function rewriteMainDomainHrefs(){const t=(t=document)=>{t.querySelectorAll("a[href]").forEach(t=>{isMainOriginUrl(t.getAttribute("href")||"")&&t.setAttribute("href",isStake?MAIN_BASE+"/":"/")})};t(),new MutationObserver(e=>{for(const i of e){if("attributes"===i.type&&"A"===i.target.tagName&&"href"===i.attributeName){const t=i.target;isMainOriginUrl(t.getAttribute("href")||"")&&t.setAttribute("href",isStake?MAIN_BASE+"/":"/")}"childList"===i.type&&i.addedNodes.forEach(e=>{1===e.nodeType&&t(e)})}}).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["href"]})}function blockOrRedirectMainOrigin(){const t=t=>{const e=t.composedPath?t.composedPath():[t.target],i=e.find(t=>t&&"A"===t.tagName&&void 0!==t.href),o=i&&i.getAttribute("href")||"",r=e.find(t=>t&&t.getAttribute&&t.getAttribute("data-href"));isMainOriginUrl(o||(r?r.getAttribute("data-href"):""))&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),redirectToLocalMain())};["click","pointerdown","mousedown","mouseup","auxclick","touchstart","touchend"].forEach(e=>document.addEventListener(e,t,!0));const e=window.open;window.open=function(t,i,o){return isMainOriginUrl(String(t))?(redirectToLocalMain(),null):e.apply(window,arguments)}}function enforceStakeAllowlist(){if(!isStake)return;const t=new Set(["/","/wrap/","/rewards/","/withdrawals/request/"]),e=e=>{const i=(e.composedPath?e.composedPath():[e.target]).find(t=>t&&"A"===t.tagName&&void 0!==t.href);if(!i)return;let o=i.getAttribute("href")||"";try{o.startsWith("http")&&(o=new URL(o).pathname)}catch{}return o=folderize(o),"/withdrawals/"===o&&(o="/withdrawals/request/"),t.has(o)?(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),void(location.href=o)):isMainOriginUrl(i.getAttribute("href")||"")?(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),void redirectToLocalMain()):(e.preventDefault(),e.stopPropagation(),void e.stopImmediatePropagation())};["click","pointerdown","mousedown","mouseup","auxclick","touchstart","touchend"].forEach(t=>document.addEventListener(t,e,!0))}function forceHardNav(){document.addEventListener("click",t=>{const e=t.target.closest&&t.target.closest("a[href]");if(!e)return;const i=e.getAttribute("href")||"";isStake&&i.startsWith("/")&&(t.preventDefault(),location.href=folderize(i))},!0)}rewriteStakeLinks(),guardMainLinksStrict(),rewriteMainDomainHrefs(),blockOrRedirectMainOrigin(),enforceStakeAllowlist(),forceHardNav();